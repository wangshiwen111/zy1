## 1.项目概述
本项目旨在通过回归分析方法对南瓜价格数据进行建模和预测。具体目标包括：数据探索与分析，通过可视化和统计分析，了解不同特征（如品种、产地、商品尺寸等）对南瓜价格的影响；特征工程，选择和处理关键特征，包括日期特征的提取和分类特征的编码；模型构建与训练，使用机器学习算法（如随机森林回归器）构建预测模型，并对模型进行训练和评估；模型评估与优化，通过均方误差（MSE）和R²分数等指标评估模型性能，并进行特征重要性分析和残差分析，以优化模型；结果展示与解释，通过可视化和统计分析展示模型结果，解释模型的预测能力和特征的重要性。

## 2.数据来源
数据来源于一个CSV文件，包含南瓜的多个特征和价格信息。数据集的具体结构如下：
- **City Name**：城市名称
- **Type**：南瓜类型
- **Package**：包装类型
- **Variety**：南瓜品种
- **Sub Variety**：亚品种
- **Grade**：等级
- **Date**：日期
- **Low Price**：最低价格
- **High Price**：最高价格
- **Mostly Low**：主要低价
- **Mostly High**：主要高价
- **Origin**：产地
- **Origin District**：产地地区
- **Item Size**：商品尺寸
- **Color**：颜色
- **Environment**：环境
- **Unit of Sale**：销售单位
- **Quality**：质量
- **Condition**：状况
- **Appearance**：外观
- **Storage**：存储条件
- **Crop**：作物类型
- **Repack**：重新包装
- **Trans Mode**：运输方式

## 3.分析思路
1. **数据预处理**：
   - 处理缺失值：填充或删除缺失值。
   - 特征工程：提取日期特征（月份和周）。
   - 编码分类变量：使用One-Hot编码处理分类特征。
   - 标准化数值特征：使用StandardScaler对数值特征进行标准化。

2. **模型训练**：
   - 使用随机森林回归模型进行训练。
   - 划分训练集和测试集，使用80%的数据进行训练，20%的数据进行测试。

3. **模型评估**：
   - 使用均方误差（MSE）和决定系数（R²）评估模型性能。
   - 绘制实际值与预测值的对比图，直观展示模型预测效果。

4. **特征重要性分析**：
   - 计算并绘制特征重要性，了解哪些特征对价格预测影响最大。

5. **学习曲线分析**：
   - 绘制学习曲线，评估模型在不同训练集大小下的性能，判断是否存在过拟合或欠拟合。

6. **残差分析**：
   - 绘制残差图，评估模型预测误差的分布情况。

7. **特征相关性分析**：
   - 计算并绘制特征之间的相关性热力图，了解特征之间的关系。

8. **模型复杂度分析**：
   - 绘制验证曲线，评估模型在不同参数设置下的性能，选择最优的模型参数。

## 4.分析过程
###   1.数据预处理
加载了包含南瓜价格及相关特征信息的数据集 “US-pumpkins.csv”。通过调用 df.shape，掌握了数据集的整体规模，明确数据集中样本的数量以及每个样本所包含的特征维度。运用 df.isnull().sum() 对数据集中的缺失值情况进行了全面排查，并按照缺失值数量进行降序排列，以便直观地呈现各特征列的缺失程度。
![image](https://github.com/user-attachments/assets/9a915353-3693-43e5-95bc-d1ee6c897069)

根据缺失值统计结果，数据集中多个特征存在不同程度的缺失，特别是“Unnamed: 25”和“Origin District”特征，缺失值数量较大，分别为1654和1626。后续工作包括对这些缺失值进行处理，采用填充或删除的方法。对于异常值，通过计算四分位数和四分位距（IQR），并剔除超出1.5倍IQR范围的数据，以提高数据质量。特征工程方面，对分类特征进行独热编码，对数值特征进行标准化处理，以适应随机森林回归模型的需求。
### 2.关键特征选择
![image](https://github.com/user-attachments/assets/4f092fd4-bdee-499a-8680-58d9f233ef29)
价格分布直方图分析：实验结果显示，南瓜的低价格和高价格均呈现出右偏分布，大部分数据集中在较低的价格区间，随着价格的增加，样本数量逐渐减少。低价格的分布较为分散，而高价格的分布则相对集中，表明市场上南瓜的最低价格差异较大，而最高价格相对稳定。主要低价的分布与低价格类似，但分布更为集中，表明大多数南瓜的价格集中在较低的区间。主要高价的分布与高价格相似，但样本数量更少，表明市场上高价南瓜的数量较少。
![image](https://github.com/user-attachments/assets/c650517b-8e0d-46a3-b556-558c962d31b7)
特征分布柱状图分析：不同品种南瓜的数量分布显示，“squ”品种的南瓜数量最多，其次是“red”和“lgs”品种，品种的分布不均匀，可能表明某些品种在市场上更受欢迎或更常见。散点图展示了不同产地南瓜的低价格和高价格分布，不同颜色代表不同的品种，可以观察到，不同产地的南瓜价格存在差异，且同一产地的南瓜价格也有较大的波动范围。某些品种的南瓜在特定产地的价格可能更高，这可能与产地的气候、土壤条件或种植技术有关。
![image](https://github.com/user-attachments/assets/38f29157-e829-4805-a5b4-09621dd64a11)
按月分析南瓜价格的箱线图显示了不同月份南瓜低价格的分布情况。6月份的南瓜价格中位数最高，且价格波动范围较大，这可能与南瓜的供应量或市场需求的季节性变化有关。其他月份的价格相对稳定，但10月和11月的价格波动较大，可能受到节假日或市场活动的影响。
### 3.特征工程
对日期字段进行了特征工程，提取了月份和周信息作为时间特征，这有助于模型捕捉南瓜价格的季节性和周度变化。接着，处理了数据集中的缺失值，对于分类特征如颜色、商品尺寸和销售单位，采用了填充策略，使用最常见的类别或基于业务假设的值进行填充，从而确保了数据的完整性。为了提高数据质量，还通过计算第一四分位数（Q1）、第三四分位数（Q3）和四分位距（IQR），并应用1.5倍IQR规则来识别和删除异常值。
### 4. 模型构建与训练
在模型构建与训练阶段，对数据集中的特征进行了编码和标准化处理。对于数值特征，使用了`StandardScaler`进行标准化，这一步骤有助于将不同特征的数值范围统一化，从而消除不同特征量纲的影响，使得模型训练更加稳定。对于分类特征，采用了`OneHotEncoder`进行独热编码，将分类变量转换为模型可以处理的数值形式，同时保留了特征间的独立性，避免了潜在的偏序关系对模型造成的干扰。
在特征预处理的基础上，构建了一个包含预处理步骤和随机森林回归器的管道模型。管道的使用简化了模型训练流程。此外，为了评估模型的泛化能力，按照8:2的比例划分为训练集和测试集。训练集用于模型的训练，而测试集则用于评估模型在未见过的数据上的表现。
最后使用训练集对模型进行了训练。随机森林回归器是一种基于集成学习的模型，它通过构建多个决策树并综合它们的预测结果来提高模型的准确性和稳定性。在训练过程中，模型学习了各个特征与南瓜价格之间的复杂关系，并优化了预测性能。通过这一过程，构建了一个强大的预测模型，为南瓜价格的准确预测奠定了基础。
### 5. 模型评估
#### 5.1 性能指标
为了量化模型预测南瓜价格的准确性，计算了两个关键的性能指标：均方误差（MSE）和R²分数。均方误差衡量了模型预测值与实际值之间差异的平方的平均值，值越小表示模型的预测误差越小。R²分数，又称为决定系数，衡量了模型解释数据变异性的能力，其值介于0和1之间，值越接近1表示模型的解释能力越强。
![image](https://github.com/user-attachments/assets/21bca9b0-0f8b-438e-b069-2fade27f7997)

模型的性能指标结果显示，均方误差（MSE）为243.73，R²分数为0.9673。均方误差是衡量模型预测值与实际值之间差异的常用指标，其值越小表示模型的预测精度越高。在此模型中，MSE值相对较低，表明预测值与实际值之间的误差较小，模型具有较高的预测准确性。R²分数，即决定系数，是衡量模型解释变量变异性的能力的指标，其值介于0和1之间。R²分数为0.9673，接近1，说明模型能够解释大部分的数据变异性，具有很好的拟合效果。
#### 5.2 可视化分析
为了直观展示模型的预测能力，绘制了实际值与预测值的对比图。该图通过散点图的形式展示了每个样本的实际南瓜价格与模型预测价格之间的关系。图中还包括了一条y=x的参考线，用于直观比较预测值与实际值的接近程度。如果模型预测准确，大部分点应接近这条线。
![image](https://github.com/user-attachments/assets/63408979-cffc-41c4-93f0-025ea8d6191b)
图中展示的散点图分析显示，模型在南瓜价格预测方面表现良好，大多数预测点都紧密聚集在代表完美预测的虚线附近，这表明预测价格与实际价格之间具有高度一致性。点的紧密分布表明模型能够准确捕捉价格变化的趋势，并且随着实际价格的增加，预测价格也相应增加，显示出明显的线性关系。尽管存在一些离群点，它们可能由于数据中的异常值、未被模型捕捉到的特征影响，或模型本身的局限性导致预测误差较大，但整体而言，这些离群点并未对模型的整体预测能力造成显著影响。
#### 5.3 特征重要性分析
为了了解哪些特征对南瓜价格的影响最大，进行了特征重要性分析。通过随机森林模型提供的内置特征重要性评估，可以识别出对模型预测结果影响最大的特征。这一分析有助于理解南瓜价格的决定因素，为农业生产和市场销售提供指导。特征重要性分析的结果以可视化图表的形式呈现，直观展示了各个特征的重要性排序，使得关键特征一目了然。
![image](https://github.com/user-attachments/assets/3f74bb73-0291-44ca-a84b-640b687744c7)
该图展示了南瓜价格预测模型中最重要的15个特征，其中“Variety_PIE TYPE”和“Package_1/2 bushel cartons”特征的重要性最高，表明南瓜的品种和包装类型对价格有显著影响。此外，月份、不同包装规格如“Package_36 inch bins”和“Package_40 lb cartons”也显示出较高的重要性，说明时间因素和包装规格同样是影响南瓜价格的关键因素。
#### 5.4 残差分析
为了评估模型的拟合效果，进行了残差分析。残差是实际观测值与模型预测值之间的差异，残差分析有助于揭示模型可能存在的系统性误差。通过绘制残差图，即以模型预测值为x轴，残差为y轴的散点图，可以直观地观察残差的分布情况。一个良好的模型，其残差应随机分布在0附近，没有明显的模式或趋势。如果残差图中显示出某种模式，可能表明模型未能捕捉到数据中的某些信息，需要进一步调整或选择其他模型。
![image](https://github.com/user-attachments/assets/613bc410-f6d0-4856-86fd-19d0d75b9edd)

该残差图展示了模型预测价格与实际价格之间的差异，即残差。图中的横坐标代表模型的预测价格，纵坐标代表残差。理想情况下，残差应该随机分布在0附近，没有明显的模式。从图中可以看出，大多数残差集中在0附近，表明模型的预测在大多数情况下是准确的。然而，也存在一些离群点，这些点的残差较大，表明在这些情况下模型的预测误差较大。
### 6.结论
本次实验通过构建南瓜价格预测模型，展示了机器学习技术在农业经济数据分析中的应用。数据预处理阶段确保了数据质量，特征工程中提取的日期特征和对分类特征的独热编码、数值特征的标准化处理，均有助于提升模型性能。随机森林回归器的选用和管道的构建简化了模型训练流程。模型评估结果显示出较高的预测准确性，均方误差（MSE）为243.73，R²分数达到0.9673，表明模型能够很好地解释数据的变异性。实际值与预测值的对比图直观展示了模型的预测能力，大多数预测点紧密聚集在理想预测线附近。特征重要性分析揭示了品种、包装类型和月份等关键因素对南瓜价格的影响。残差分析指出模型在大多数情况下预测准确，但对离群点的预测仍有改进空间。实验结果不仅建立了一个有效的南瓜价格预测模型，而且为农业生产和市场销售提供了有价值的见解。未来的工作可以进一步优化模型，提高预测精度，或将模型应用于其他农业产品价格预测问题。
